scheduler.templates.calendar_month=scheduler.date.date_to_str("%Y / %m");scheduler.templates.calendar_scale_date=scheduler.date.date_to_str("%D");scheduler.templates.calendar_date=scheduler.date.date_to_str("%d");scheduler.renderCalendar=function(n,t){var u=null,e=n.date||new Date,f,i,h,c,s,l,r;typeof e=="string"&&(e=this.templates.api_date(e));t?(u=this._render_calendar(t.parentNode,e,n,t),scheduler.unmarkCalendar(u)):(f=n.container,i=n.position,typeof f=="string"&&(f=document.getElementById(f)),typeof i=="string"&&(i=document.getElementById(i)),i&&typeof i.left=="undefined"&&(h=0,n.adjust&&(h=n.adjust),c=getOffset(i),i={top:c.top+i.offsetHeight,left:c.left+h}),f||(f=scheduler._get_def_cont(i)),u=this._render_calendar(f,e,n),u.onclick=function(n){var i,r,t;n=n||event;i=n.target||n.srcElement;i.className.indexOf("dhx_month_head")!=-1&&(r=i.parentNode.className,r.indexOf("dhx_after")==-1&&r.indexOf("dhx_before")==-1&&(t=scheduler.templates.xml_date(this.getAttribute("date")),t.setDate(parseInt(i.innerHTML,10)),scheduler.unmarkCalendar(this),scheduler.markCalendar(this,t,"dhx_calendar_click"),this._last_date=t,this.conf.handler&&this.conf.handler.call(scheduler,t,this)))});var o=scheduler.date.month_start(e),a=scheduler.date.add(o,1,"month"),v=this.getEvents(o,a);for(s=0;s<v.length;s++)for(l=v[s],r=l.start_date,r.valueOf()<o.valueOf()&&(r=o);r<=l.end_date;)if(this.markCalendar(u,r,"dhx_year_event"),r=this.date.add(r,1,"day"),r.valueOf()>=a.valueOf())break;return u.conf=n,u};scheduler._get_def_cont=function(n){return this._def_count||(this._def_count=document.createElement("DIV"),this._def_count.style.cssText="position:absolute;z-index:10100;width:261px; height:205px;",this._def_count.className="dhx_minical_div",this._def_count.onclick=function(n){(n||event).cancelBubble=!0},document.body.appendChild(this._def_count)),this._def_count.style.left=n.left+"px",this._def_count.style.top=n.top+"px",this._def_count._created=new Date,this._def_count};scheduler._locateCalendar=function(n,t){var r=n.childNodes[2].childNodes[0],i;return typeof t=="string"&&(t=scheduler.templates.api_date(t)),i=n.week_start+t.getDate()-1,r.rows[Math.floor(i/7)].cells[i%7].firstChild};scheduler.markCalendar=function(n,t,i){this._locateCalendar(n,t).className+=" "+i};scheduler.unmarkCalendar=function(n,t,i){if(t=t||n._last_date,i=i||"dhx_calendar_click",t){var r=this._locateCalendar(n,t);r.className=(r.className||"").replace(RegExp(i,"g"))}};scheduler._week_template=function(n){for(var u=n||250,f=0,i=document.createElement("div"),r=this.date.week_start(new Date),t=0;t<7;t++)this._cols[t]=Math.floor(u/(7-t)),this._render_x_header(t,f,r,i),r=this.date.add(r,1,"day"),u-=this._cols[t],f+=this._cols[t];return i.lastChild.className+=" dhx_scale_bar_last",i};scheduler.updateCalendar=function(n,t){n.conf.date=t;this.renderCalendar(n.conf,n)};scheduler._mini_cal_arrows=['<a href="javascript:void(0);"><span class="fa fa-chevron-circle-left"><\/span>','<a href="javascript:void(0);"><span class="fa fa-chevron-circle-right"><\/span>'];scheduler._render_calendar=function(n,t,i,r){var s=scheduler.templates,y=this._cols,c,l,a,u,f,v,e,o,h;this._cols=[];c=this._mode;this._mode="calendar";l=this._colsS;this._colsS={height:0};var p=new Date(this._min_date),w=new Date(this._max_date),b=new Date(scheduler._date),k=s.month_day;for(s.month_day=s.calendar_date,t=this.date.month_start(t),a=this._week_template(n.offsetWidth-1),r?u=r:(u=document.createElement("DIV"),u.className="dhx_cal_container dhx_mini_calendar"),u.setAttribute("date",this.templates.xml_format(t)),u.innerHTML="<div class='dhx_year_month'><\/div><div class='dhx_year_week'>"+a.innerHTML+"<\/div><div class='dhx_year_body'><\/div>",u.childNodes[0].innerHTML=this.templates.calendar_month(t),i.navigation&&(f=document.createElement("DIV"),f.className="dhx_cal_prev_button",f.style.cssText="left:1px;top:2px;position:absolute;",f.innerHTML=this._mini_cal_arrows[0],u.firstChild.appendChild(f),f.onclick=function(){scheduler.updateCalendar(u,scheduler.date.add(u._date,-1,"month"))},f=document.createElement("DIV"),f.className="dhx_cal_next_button",f.style.cssText="left:auto; right:1px;top:2px;position:absolute;",f.innerHTML=this._mini_cal_arrows[1],u.firstChild.appendChild(f),f.onclick=function(){scheduler.updateCalendar(u,scheduler.date.add(u._date,1,"month"))},u._date=new Date(t)),u.week_start=(t.getDay()-(this.config.start_on_monday?1:0)+7)%7,v=this.date.week_start(t),this._reset_month_scale(u.childNodes[2],t,v),e=u.childNodes[2].firstChild.rows,o=e.length;o<6;o++)for(e[0].parentNode.appendChild(e[0].cloneNode(!0)),h=0;h<e[o].childNodes.length;h++)e[o].childNodes[h].className="dhx_after";return r||n.appendChild(u),this._cols=y,this._mode=c,this._colsS=l,this._min_date=p,this._max_date=w,scheduler._date=b,s.month_day=k,stdate=this.templates.load_format(t),setstdate=getHolidayslink(stdate,"month"),dhtmlxAjax.get(setstdate,function(n){this.holidays=n.xmlDoc.responseText;this.holidays=this.holidays.replace(/\[|\]/g,"");this.holidays=this.holidays.replace(/\"/g,"");this.holidays=this.holidays.split(",");for(var t=0;t<this.holidays.length;t++)checkid=document.getElementById(this.holidays[t]+"_head"),checkid!=null&&(checkid.classList.add("day_holiday"),checkid=document.getElementById(this.holidays[t]+"_body"),checkid.classList.add("day_holiday"))}),u};scheduler.destroyCalendar=function(n,t){(!n&&this._def_count&&this._def_count.firstChild&&(t||(new Date).valueOf()-this._def_count._created.valueOf()>500)&&(n=this._def_count.firstChild),n)&&(n.onclick=null,n.innerHTML="",n.parentNode&&n.parentNode.removeChild(n),this._def_count&&(this._def_count.style.top="-1000px"))};scheduler.isCalendarVisible=function(){return this._def_count&&parseInt(this._def_count.style.top,10)>0?this._def_count:!1};scheduler.attachEvent("onTemplatesReady",function(){dhtmlxEvent(document.body,"click",function(){scheduler.destroyCalendar()})});scheduler.templates.calendar_time=scheduler.date.date_to_str("%Y-%m-%d");scheduler.form_blocks.calendar_time={render:function(){var n="<input class='dhx_readonly' type='text' readonly='true' id='bsinputstart'>",t=scheduler.config,i=this.date.date_part(new Date),r,u,f;for(t.first_hour&&i.setHours(t.first_hour),n+=" <select>",r=60*t.first_hour;r<60*t.last_hour;r+=this.config.time_step*1)u=this.templates.time_picker(i),n+="<option value='"+r+"'>"+u+"<\/option>",i=this.date.add(i,this.config.time_step,"minute");return n+="<\/select>",f=scheduler.config.full_day,"<div style='height:26px; font-size:inherit;' class='dhx_cal_lsection dhx_section_time'>"+n+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; <\/span>"+n.replace("bsinputstart","bsinputend")+"<\/div>"},set_value:function(n,t,i){function o(n,t,i){s(n,t,i);n.value=scheduler.templates.calendar_time(t);n._date=scheduler.date.date_part(new Date(t))}var u=n.getElementsByTagName("input"),r=n.getElementsByTagName("select"),s=function(n,t,i){n.onclick=function(){scheduler.destroyCalendar(null,!0);scheduler.renderCalendar({position:n,date:new Date(this._date),navigation:!0,handler:function(t){n.value=scheduler.templates.calendar_time(t);n._date=new Date(t);scheduler.bsinputstart_onchange();scheduler.destroyCalendar();scheduler.config.event_duration&&i==0&&J()}})}},f,h,e;if(scheduler.config.full_day){n._full_day||(n.previousSibling.innerHTML+="<div class='dhx_fullday_checkbox'><label><input type='checkbox' name='full_day' value='true'> "+scheduler.locale.labels.full_day+"&nbsp;<\/label><\/input><\/div>",n._full_day=!0);f=n.previousSibling.getElementsByTagName("input")[0];h=scheduler.date.time_part(i.start_date)==0&&scheduler.date.time_part(i.end_date)==0&&i.end_date.valueOf()-i.start_date.valueOf()<1728e5;f.checked=h;for(e in r)r[e].disabled=f.checked;for(e=0;e<u.length-1;e++)u[e].disabled=f.checked;f.onclick=function(){var t,h,e,s,n;f.checked==!0&&(t=new Date(i.start_date),h=new Date(i.end_date),scheduler.date.date_part(t),h=scheduler.date.add(t,1,"day"));e=t||i.start_date;s=h||i.end_date;o(u[0],e);o(u[1],s);r[0].value=e.getHours()*60+e.getMinutes();r[1].value=s.getHours()*60+s.getMinutes();for(n in r)r[n].disabled=f.checked;for(n=0;n<u.length-1;n++)u[n].disabled=f.checked}}if(scheduler.config.event_duration){function J(){i.start_date=scheduler.date.add(u[0]._date,r[0].value,"minute");i.end_date.setTime(i.start_date.getTime()+scheduler.config.event_duration*6e4);u[1].value=scheduler.templates.calendar_time(i.end_date);u[1]._date=scheduler.date.date_part(new Date(i.end_date));r[1].value=i.end_date.getHours()*60+i.end_date.getMinutes()}for(e in r)r[e].onchange=J}o(u[0],i.start_date,0);o(u[1],i.end_date,1);s=function(){};r[0].value=i.start_date.getHours()*60+i.start_date.getMinutes();r[1].value=i.end_date.getHours()*60+i.end_date.getMinutes()},get_value:function(n,t){var i=n.getElementsByTagName("input"),r=n.getElementsByTagName("select"),u,f,e,o,s,h;t.start_date=scheduler.date.add(i[0]._date,r[0].value,"minute");t.end_date=scheduler.date.add(i[1]._date,r[1].value,"minute");t.rec_type?(t._start_date&&(t.start_date=new Date(t.start_date.getFullYear(),t.start_date.getMonth(),t._start_date.getDate(),t.start_date.getHours(),t.start_date.getMinutes())),u=t.rec_type.lastIndexOf("#"),f=t.rec_type.substr(u+1),f||t._end_date<t.start_date&&(t._end_date=new Date(t.start_date.getFullYear(),t.start_date.getMonth(),t.start_date.getDate())),e=new Date(t.start_date.getFullYear(),t.start_date.getMonth(),t.start_date.getDate()),o=new Date(t.end_date.getFullYear(),t.end_date.getMonth(),t.end_date.getDate()),o!=e&&(t.end_date=new Date(t.start_date.getFullYear(),t.start_date.getMonth(),t.start_date.getDate(),t.end_date.getHours(),t.end_date.getMinutes())),s=new Date(1980,1,1,t.start_date.getHours(),t.start_date.getMinutes()),h=new Date(1980,1,1,t.end_date.getHours(),t.end_date.getMinutes()),h<s&&(t.end_date=scheduler.date.add(t.start_date,scheduler.config.time_step,"minute"))):t.end_date<=t.start_date&&(t.end_date=scheduler.date.add(t.start_date,scheduler.config.time_step,"minute"))},focus:function(){}};scheduler.linkCalendar=function(n,t){var r=function(){var u=scheduler._date,e=scheduler._mode,r=new Date(u.valueOf()),f;if(t&&(r=t(r)),r.setDate(1),scheduler.updateCalendar(n,r),!t)if(e=="day")scheduler.markCalendar(n,u,"dhx_calendar_click");else if(e=="week")for(r=scheduler.date.week_start(new Date(u.valueOf())),i=0;i<7;i++)(f=r.getMonth()+r.getYear()*12-u.getMonth()-u.getYear()*12,f&&f>0)||(scheduler.markCalendar(n,r,"dhx_calendar_click"),r=scheduler.date.add(r,1,"day"));return!0};scheduler.attachEvent("onViewChange",r);scheduler.attachEvent("onXLE",r);scheduler.attachEvent("onEventAdded",r);scheduler.attachEvent("onEventChanged",r);scheduler.attachEvent("onAfterEventDelete",r);r()}