(function(){function e(){for(var r,t,u=scheduler.getEvents(scheduler._min_date,scheduler._max_date),i=[],n=0;n<this.y_unit.length;n++)i[n]=[];for(i[r]||(i[r]=[]),n=0;n<u.length;n++){for(r=this.order[u[n][this.y_property]],t=0;this._trace_x[t+1]&&u[n].start_date>=this._trace_x[t+1];)t++;while(this._trace_x[t]&&u[n].end_date>this._trace_x[t])i[r][t]||(i[r][t]=[]),i[r][t].push(u[n]),t++}return i}function i(n,t,i){var s=0,u=t?n.end_date:n.start_date,r,o,f,h,e;if(u.valueOf()>scheduler._max_date.valueOf()&&(u=scheduler._max_date),r=u-scheduler._min_date_timeline,r<0)e=0;else{for(o=Math.round(r/(i*scheduler._cols[0])),f=0;f<o;f++)s+=scheduler._cols[f];h=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*o,scheduler.matrix[scheduler._mode].x_unit);r=u-h;e=Math.floor(r/i)}return s+(t?e-14:e+1)}function o(n){var f="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",u=[],c,l,s,h,p,r,a,v,o,i,y,t;if(!scheduler._load_mode||!scheduler._load()){if(this.render=="cell")u=e.call(this);else for(c=scheduler.getEvents(scheduler._min_date,scheduler._max_date),i=0;i<c.length;i++)l=this.order[c[i][this.y_property]],u[l]||(u[l]=[]),u[l].push(c[i]);for(s=0,t=0;t<scheduler._cols.length;t++)s+=scheduler._cols[t];for(h=new Date,h=(scheduler.date.add(h,this.x_step*this.x_size,this.x_unit)-h)/s,this._step=h,this._summ=s,p=scheduler._colsS.heights=[],t=0;t<this.y_unit.length;t++){if(r=this._logic(this.render,this.y_unit[t],this),scheduler._merge(r,{height:this.dy}),this.section_autoheight&&this.y_unit.length*r.height<n.offsetHeight&&(r.height=Math.max(r.height,Math.floor((n.offsetHeight-1)/this.y_unit.length))),scheduler._merge(r,{tr_className:"",style_height:"height:"+r.height+"px;",style_width:"width:"+(this.dx-1)+"px;",td_className:"dhx_matrix_scell "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[t].key,this.y_unit[t].label,this),td_content:scheduler.templates[this.name+"_scale_label"](this.y_unit[t].key,this.y_unit[t].label,this),summ_width:"width:"+s+"px;",table_className:""}),f+="<tr class='"+r.tr_className+"' style='"+r.style_height+"'><td class='"+r.td_className+"' style='"+r.style_width+"'>"+r.td_content+"<\/td>",this.render=="cell")for(i=0;i<scheduler._cols.length;i++)f+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](u[t][i],this._trace_x[i],this.y_unit[t])+"' style='width:"+(scheduler._cols[i]-1)+"px'><div style='width:"+(scheduler._cols[i]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](u[t][i])+"<div><\/td>";else{if(f+="<td><div style='"+r.summ_width+" "+r.style_height+" position:relative;' class='dhx_matrix_line'>",u[t])for(u[t].sort(function(n,t){return n.start_date>t.start_date?1:-1}),a=[],i=0;i<u[t].length;i++){for(v=u[t][i],o=0;a[o]&&a[o].end_date>v.start_date;)o++;a[o]=v;f+=scheduler.render_timeline_event.call(this,v,o)}for(f+="<table class='"+r.table_className+"' cellpadding='0' cellspacing='0' style='"+r.summ_width+" "+r.style_height+"' >",i=0;i<scheduler._cols.length;i++)f+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](u[t],this._trace_x[i],this.y_unit[t])+"' style='width:"+(scheduler._cols[i]-1)+"px'><div style='width:"+(scheduler._cols[i]-1)+"px'><div><\/td>";f+="<\/table>";f+="<\/div><\/td>"}f+="<\/tr>"}for(f+="<\/table>",this._matrix=u,n.scrollTop=0,n.innerHTML=f,scheduler._rendered=[],y=document.getElementsByTagName("DIV"),t=0;t<y.length;t++)y[t].getAttribute("event_id")&&scheduler._rendered.push(y[t]);for(t=0;t<n.firstChild.rows.length;t++)p.push(n.firstChild.rows[t].offsetHeight)}}function s(n){var t,r,u;n.innerHTML="<div><\/div>";n=n.firstChild;scheduler._cols=[];scheduler._colsS={height:0};this._trace_x=[];scheduler._min_date_timeline=scheduler._min_date;var i=scheduler._min_date,e=scheduler._x-this.dx-18,o=this.dx;for(t=0;t<this.x_size;t++)scheduler._cols[t]=Math.floor(e/(this.x_size-t)),this._trace_x[t]=new Date(i),scheduler._render_x_header(t,o,i,n),r=scheduler.templates[this.name+"_scalex_class"](i),r&&(n.lastChild.className+=" "+r),i=scheduler.date.add(i,this.x_step,this.x_unit),e-=scheduler._cols[t],o+=scheduler._cols[t];u=this._trace_x;n.onclick=function(n){var t=f(n);t&&scheduler.callEvent("onXScaleClick",[t.x,u[t.x],n||event])};n.ondblclick=function(n){var t=f(n);t&&scheduler.callEvent("onXScaleDblClick",[t.x,u[t.x],n||event])}}function n(n){if(n){scheduler.set_sizes();u();var t=scheduler._min_date;s.call(this,scheduler._els.dhx_cal_header[0]);o.call(this,scheduler._els.dhx_cal_data[0]);scheduler._min_date=t;scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date);scheduler._table_view=!0}}function t(){scheduler._tooltip&&(scheduler._tooltip.style.display="none",scheduler._tooltip.date="")}function r(n,i,u){var c,f,h,l,o,e,s;if(n.render=="cell"){if(c=i.x+"_"+i.y,f=n._matrix[i.y][i.x],!f)return t();if(f.sort(function(n,t){return n.start_date>t.start_date?1:-1}),scheduler._tooltip){if(scheduler._tooltip.date==c)return;scheduler._tooltip.innerHTML=""}else h=scheduler._tooltip=document.createElement("DIV"),h.className="dhx_tooltip",l=document.getElementById("dhx_cal_tooltips"),l.appendChild(h),h.onclick=scheduler._click.dhx_cal_data;for(o="",e=0;e<f.length;e++)s="0",scheduler._showbox_check(t[r])==!0&&(s="1"),o+="<div class='dhx_tooltip_line' event_id='"+f[e].id+"' show_flg='"+s+"'>",o+="<div class='dhx_tooltip_date' show_flg='"+s+"'>"+(f[e]._timed?scheduler.templates.event_date(f[e].start_date):"")+"<\/div>",o+="<div class='dhx_event_icon icon_details' show_flg='"+s+"'>&nbsp;<\/div>",o+=scheduler._getPriority_icon(f[e]),o+=scheduler.templates[n.name+"_tooltip"](f[e].start_date,f[e].end_date,f[e])+"<\/div>";scheduler._tooltip.style.display="";scheduler._tooltip.style.top="0px";scheduler._tooltip.style.left=document.body.offsetWidth-u.left-scheduler._tooltip.offsetWidth<0?u.left-scheduler._tooltip.offsetWidth+"px":u.left+i.src.offsetWidth+"px";scheduler._tooltip.date=c;scheduler._tooltip.innerHTML=o;scheduler._tooltip.style.top=document.body.offsetHeight-u.top-scheduler._tooltip.offsetHeight<0?u.top-scheduler._tooltip.offsetHeight+i.src.offsetHeight+"px":u.top+"px"}}function u(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",function(n){var i;if(scheduler._mode.indexOf("timeline")!=-1){if(i=scheduler.matrix[scheduler._mode],i){var u=scheduler._locate_cell_timeline(n),n=n||event,f=n.target||n.srcElement;if(0)return r(i,u,getOffset(u.src))}t()}});u=function(){}}function h(n){for(var i=n.parentNode.childNodes,t=0;t<i.length;t++)if(i[t]==n)return t;return-1}function f(n){var t,i;for(n=n||event,t=n.target?n.target:n.srcElement;t&&t.tagName!="DIV";)t=t.parentNode;if(t&&t.tagName=="DIV"&&(i=t.className.split(" ")[0],i=="dhx_scale_bar"))return{x:h(t),y:-1,src:t,scale:!0}}scheduler.matrix={};scheduler._merge=function(n,t){for(var i in t)typeof n[i]=="undefined"&&(n[i]=t[i])};scheduler.createTimelineView=function(t){var r,i,u;scheduler._merge(t,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,_logic:function(n,t,i){var r={};return scheduler.checkEvent("onBeforeViewRender")&&(r=scheduler.callEvent("onBeforeViewRender",[n,t,i])),r}});scheduler.checkEvent("onTimelineCreated")&&scheduler.callEvent("onTimelineCreated",[t]);scheduler[t.name+"_view"]=function(){scheduler.renderMatrix.apply(t,arguments)};r=scheduler.render_data;scheduler.render_data=function(i,u){if(this._mode==t.name)if(u)for(var f=0;f<i.length;f++)this.clear_event(i[f]),this.render_timeline_event.call(this.matrix[this._mode],i[f],0,!0);else n.call(t,!0);else return r.apply(this,arguments)};scheduler.callEvent("onOptionsLoad",[t]);scheduler.matrix[t.name]=t;scheduler.templates[t.name+"_cell_value"]=function(n){return n?n.length:""};scheduler.templates[t.name+"_cell_class"]=function(){return""};scheduler.templates[t.name+"_scalex_class"]=function(){return""};scheduler.templates[t.name+"_scaley_class"]=function(){return"class"};scheduler.templates[t.name+"_scale_label"]=function(n,t){return t};scheduler.templates[t.name+"_tooltip"]=function(n,t,i){return i.text};scheduler.templates[t.name+"_date"]=function(n,t){return n.getDay()==t.getDay()&&n-t<864e5?scheduler.templates.day_date(n):scheduler.templates.week_date(n,t)};scheduler.templates[t.name+"_scale_date"]=scheduler.date.date_to_str(t.x_date||scheduler.config.hour_date);scheduler.date["add_"+t.name]=function(n,i){return scheduler.date.add(n,(t.x_length||t.x_size)*i*t.x_step,t.x_unit)};scheduler.date[t.name+"_start"]=scheduler.date[t.x_unit+"_start"]||scheduler.date.day_start;scheduler.attachEvent("onSchedulerResize",function(){return this._mode==t.name?(n.call(t,!0),!1):!0});t.render!="cell"&&(i=new Date,u=scheduler.date.add(i,1,t.x_unit).valueOf()-i.valueOf(),scheduler["mouse_"+t.name]=function(n){var e=this._drag_event,o;this._drag_id&&(e=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0);n.x-=t.dx;var f=0,i=0,r=0;for(i;i<this._cols.length-1;i++)if(f+=this._cols[i],f>n.x)break;for(f=0,r;r<this._colsS.heights.length;r++)if(f+=this._colsS.heights[r],f>n.y)break;return n.fields={},n.fields[t.y_property]=e[t.y_property]=t.y_unit[r].key,n.x=r/1e7,this._drag_mode=="new-size"&&e.start_date*1==this._drag_start*1&&i++,o=i>=t._trace_x.length?scheduler.date.add(t._trace_x[t._trace_x.length-1],t.x_step,t.x_unit):t._trace_x[i],n.y=Math.round((o-this._min_date)/(6e4*this.config.time_step)),n.custom=!0,n.shift=u,n})};scheduler.render_timeline_event=function(n,t,r){var o=i(n,!1,this._step),c=i(n,!0,this._step),l=scheduler.xy.bar_height,a=2+t*l,f=scheduler.templates.event_class(n.start_date,n.end_date,n),e,u,s,h;if(f="dhx_cal_event_line "+(f||""),e='<div event_id="'+n.id+'" class="'+f+'" style="position:absolute; top:'+a+"px; left:"+o+"px; width:"+Math.max(0,c-o)+"px;"+(n._text_style||"")+'">'+scheduler.templates.event_bar_text(n.start_date,n.end_date,n)+"<\/div>",r)u=document.createElement("DIV"),u.innerHTML=e,s=this.order[n[this.y_property]],h=scheduler._els.dhx_cal_data[0].firstChild.rows[s].cells[1].firstChild,scheduler._rendered.push(u.firstChild),h.appendChild(u.firstChild);else return e};scheduler.renderMatrix=function(t){var i=scheduler.date[this.name+"_start"](scheduler._date);scheduler._min_date=scheduler.date.add(i,this.x_start*this.x_step,this.x_unit);scheduler._max_date=scheduler.date.add(scheduler._min_date,this.x_size*this.x_step,this.x_unit);scheduler._table_view=!0;n.call(this,t)};scheduler._locate_cell_timeline=function(n){var t,r,i;for(n=n||event,t=n.target?n.target:n.srcElement;t&&t.tagName!="TD";)t=t.parentNode;if(t&&t.tagName=="TD"){if(r=t.className.split(" ")[0],r=="dhx_matrix_cell"){if(scheduler._isRender("cell"))return{x:t.cellIndex-1,y:t.parentNode.rowIndex,src:t};for(i=t.parentNode;i&&i.tagName!="TD";)i=i.parentNode;return{x:t.cellIndex,y:i.parentNode.rowIndex,src:t}}if(r=="dhx_matrix_scell")return{x:-1,y:t.parentNode.rowIndex,src:t,scale:!0}}return!1};var c=scheduler._click.dhx_cal_data;scheduler._click.dhx_cal_data=function(n){var r=c.apply(this,arguments),i=scheduler.matrix[scheduler._mode],t;return i&&(t=scheduler._locate_cell_timeline(n),t&&(t.scale?scheduler.callEvent("onYScaleClick",[t.y,i.y_unit[t.y],n||event]):scheduler.callEvent("onCellClick",[t.x,t.y,i._trace_x[t.x],(i._matrix[t.y]||{})[t.x]||[],n||event]))),r};scheduler.dblclick_dhx_matrix_cell=function(n){var i=scheduler.matrix[scheduler._mode],t;i&&(t=scheduler._locate_cell_timeline(n),t&&(t.scale?scheduler.callEvent("onYScaleDblClick",[t.y,i.y_unit[t.y],n||event]):scheduler.callEvent("onCellDblClick",[t.x,t.y,i._trace_x[t.x],(i._matrix[t.y]||{})[t.x]||[],n||event])))};scheduler.dblclick_dhx_matrix_scell=function(n){return scheduler.dblclick_dhx_matrix_cell(n)};scheduler._isRender=function(n){return scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==n};scheduler.attachEvent("onCellDblClick",function(n,t,i,r,u){if(!this.config.readonly&&(u.type!="dblclick"||this.config.dblclick_create)){var f=scheduler.matrix[scheduler._mode],e={};e.start_date=f._trace_x[n];e.end_date=f._trace_x[n+1]?f._trace_x[n+1]:scheduler.date.add(f._trace_x[n],f.x_step,f.x_unit);e[scheduler.matrix[scheduler._mode].y_property]=f.y_unit[t].key;scheduler.addEventNow(e,null,u)}});scheduler.attachEvent("onOptionsLoad",function(n){n.order={};for(var t=0;t<n.y_unit.length;t++)n.order[n.y_unit[t].key]=t;scheduler._date&&scheduler.setCurrentView(scheduler._date,scheduler._mode)});scheduler.attachEvent("onBeforeDrag",function(){return scheduler._isRender("cell")?!1:!0})})()