scheduler.form_blocks.recurring={render:function(){return scheduler.__recurring_template},set_value:function(n,t,r){function l(n){for(var t,i=0;i<n.length;i++)t=n[i],t.type=="checkbox"||t.type=="radio"?(u[t.name]||(u[t.name]=[]),u[t.name].push(t)):u[t.name]=t}function s(n){for(var i=u[n],t=0;t<i.length;t++)if(i[t].checked)return i[t].value}function w(){e("dhx_repeat_day").style.display="none";e("dhx_repeat_week").style.display="none";e("dhx_repeat_month").style.display="none";e("dhx_repeat_year").style.display="none";e("dhx_repeat_"+this.value).style.display="block";scheduler._events[scheduler._drag_id]&&scheduler.repeat_onclick()}function b(n){var t=[s("repeat")],e,i,r,f;for(a[t[0]](t,n);t.length<5;)t.push("");return e=document.getElementById("bsinputstart"),i=new Date(e.value.replace(/-/g,"/")+" 00:00:00"),n.start.setFullYear(i.getFullYear()),n.start.setMonth(i.getMonth()),n.start.setDate(i.getDate()),r="",u.end[0].checked?(n.end=new Date(9999,1,1),r="no"):u.end[2].checked?n.end=y(u.date_of_end.value):(scheduler.transpose_type(t.join("_")),r=Math.max(1,u.occurences_count.value),f=0,n.end=i?scheduler.date.add(new Date(i),r+f,t.join("_")):scheduler.date.add(new Date(n.start),r+f,t.join("_"))),t.join("_")+"#"+r}function k(n,t){var i=n.split("#"),r;n=i[0].split("_");v[n[0]](n,t);r=u.repeat[{day:0,week:1,month:2,year:3}[n[0]]];switch(i[1]){case"no":u.end[0].checked=!0;break;case"":u.end[2].checked=!0;u.date_of_end.value=p(t.end);break;default:u.end[1].checked=!0;u.occurences_count.value=i[1]}r.checked=!0;r.onclick()}var f={start:r.start_date,end:r._end_date},y=scheduler.date.str_to_date(scheduler.config.repeat_date),p=scheduler.date.date_to_str(scheduler.config.repeat_date),o=n.getElementsByTagName("FORM")[0],u=[],e,a,v,h,c;for(l(o.getElementsByTagName("INPUT")),l(o.getElementsByTagName("SELECT")),e=function(n){return document.getElementById(n)},a={month:function(n,t){if(s("month_type")=="d")n.push(Math.max(1,u.month_count.value)),t.start.setDate(u.month_day.value);else{for(n.push(Math.max(1,u.month_count2.value)),n.push(u.month_day2.value),n.push(Math.max(1,u.month_week2.value)),t.start.setDate(1),wdt=new Date(t.start),week=0,i=0;i<u.month_day2.length;i++)if(u.month_day2[i].selected==!0){week=u.month_day2[i].value;break}dy=week-wdt.getDay()+1;dy<=0&&(dy+=7);dtm=wdt.setDate(dy);dtm=wdt.getTime();dtm+=6048e5*(u.month_week2.value-1);wdt.setTime(dtm);t.start.setDate(wdt.getDate())}t._start=!0},week:function(n,t){var i,f,r;for(n.push(Math.max(1,u.week_count.value)),n.push(""),n.push(""),i=[],f=u.week_day,r=0;r<f.length;r++)f[r].checked&&i.push(f[r].value);i.length||i.push(t.start.getDay());t.start=scheduler.date.week_start(t.start);t._start=!0;n.push(i.sort().join(","))},day:function(n){s("day_type")=="d"?n.push(Math.max(1,u.day_count.value)):(n.push("week"),n.push(1),n.push(""),n.push(""),n.push("1,2,3,4,5"),n.splice(0,1))},year:function(n,t){if(s("year_type")=="d")n.push("1"),t.start.setMonth(0),t.start.setDate(u.year_day.value),t.start.setMonth(u.year_month.value);else{for(n.push("1"),n.push(u.year_day2.value),n.push(u.year_week2.value),t.start.setDate(1),t.start.setMonth(u.year_month2.value),wdt=new Date(t.start),week=0,i=0;i<u.year_day2.length;i++)if(u.year_day2[i].selected==!0){week=u.year_day2[i].value;break}dy=week-wdt.getDay()+1;dy<=0&&(dy+=7);dtm=wdt.setDate(dy);dtm=wdt.getTime();dtm+=6048e5*(u.year_week2.value-1);wdt.setTime(dtm);t.start.setDate(wdt.getDate())}t._start=!0}},v={week:function(n){var t;u.week_count.value=n[1];var i=u.week_day,r=n[4].split(","),f={};for(t=0;t<r.length;t++)f[r[t]]=!0;for(t=0;t<i.length;t++)i[t].checked=!!f[i[t].value]},month:function(n,t){n[2]==""?(u.month_type[0].checked=!0,u.month_count.value=n[1],u.month_day.value=t.start.getDate()):(u.month_type[1].checked=!0,u.month_count2.value=n[1],u.month_week2.value=n[3],u.month_day2.value=n[2])},day:function(n){u.day_type[0].checked=!0;u.day_count.value=n[1]},year:function(n,t){n[2]==""?(u.year_type[0].checked=!0,u.year_day.value=t.start.getDate(),u.year_month.value=t.start.getMonth()):(u.year_type[1].checked=!0,u.year_week2.value=n[3],u.year_day2.value=n[2],u.year_month2.value=t.start.getMonth())}},h=0;h<o.elements.length;h++){c=o.elements[h];switch(c.name){case"repeat":c.onclick=w}}scheduler.form_blocks.recurring.set_value=function(n,t,i){if(n.open=!i.rec_type,i.event_pid&&i.event_pid!="0")n.blocked=!0;else{n.blocked=!1;var r;r=i.end_date?i.end_date:i.start_date;u.date_of_end.value=r.getFullYear()+"-"+("00"+(r.getMonth()+1)).slice(-2)+"-"+("00"+r.getDate()).slice(-2)}f.start=i.start_date;f.end=i._end_date;scheduler.form_blocks.recurring.button_click(0,n.previousSibling.firstChild.firstChild,n,n);t&&k(t,f)};scheduler.form_blocks.recurring.get_value=function(n,t){return n.open?(t.rec_type=b(f),f._start?(t._start_date=t.start_date=f.start,f._start=!1):t._start_date=null,t._end_date=t.end_date=f.end,t.rec_pattern=t.rec_type.split("#")[0]):(t.rec_type=t.rec_pattern="",t._end_date=t.end_date),t.rec_type};scheduler.form_blocks.recurring.set_value(n,t,r)},get_value:function(){},focus:function(){},button_click:function(n,t,i,r){r.open||r.blocked?(r.style.height="0px",t.style.backgroundPosition="-5px 20px",t.nextSibling.innerHTML=scheduler.locale.labels.button_recurring,document.getElementById("bsinputend").disabled=!1):(jQuery(".dhx_cal_light").css("top","0"),r.style.height=jQuery(window).width()>480?"155px":"210px",t.style.backgroundPosition="-5px 0px",t.nextSibling.innerHTML=scheduler.locale.labels.button_recurring_open,scheduler._drag_id&&scheduler.repeat_onclick(),document.getElementById("bsinputend").disabled=!0);r.open=!r.open;scheduler.setLightboxSize()}};scheduler._rec_markers={};scheduler._rec_markers_pull={};scheduler._add_rec_marker=function(n,t){n._pid_time=t;this._rec_markers[n.id]=n;this._rec_markers_pull[n.event_pid]||(this._rec_markers_pull[n.event_pid]={});this._rec_markers_pull[n.event_pid][t]=n};scheduler._get_rec_marker=function(n,t){var i=this._rec_markers_pull[t];return i?i[n]:null};scheduler._get_rec_markers=function(n){return this._rec_markers_pull[n]||[]};scheduler._del_rec_marker=function(n){var i=this._rec_markers[n],t,r;if(i)delete this._rec_markers_pull[i.event_pid][i._pid_time],delete this._rec_markers[n];else for(t in this._rec_markers)if(this._rec_markers[t].id==n&&(r=this._rec_markers_pull[this._rec_markers[t].event_pid][this._rec_markers[t]._pid_time],r&&r.id==n)){delete this._rec_markers_pull[this._rec_markers[t].event_pid][this._rec_markers[t]._pid_time];delete this._rec_markers[n];break}};scheduler._rec_temp=[];scheduler.attachEvent("onEventLoading",function(n){return n.event_pid!=0&&scheduler._add_rec_marker(n,n.event_length*1e3),n.rec_type&&(n.rec_pattern=n.rec_type.split("#")[0]),!0});scheduler.attachEvent("onEventIdChange",function(n,t){var r,i;if(!this._ignore_call){for(this._ignore_call=!0,r=0;r<this._rec_temp.length;r++)i=this._rec_temp[r],i.event_pid==n&&(i.event_pid=t,this.changeEventId(i.id,t+"#"+i.id.split("#")[1]));delete this._ignore_call}});scheduler.attachEvent("onBeforeEventDelete",function(n){var i=this.getEvent(n),r,f;if(n.toString().indexOf("#")!=-1){var n=n.split("#"),u=this.uid(),t=this._copy_event(i);t.id=u;t.event_pid=n[0];t.event_length=n[1];t.rec_type="";t.rec_pattern="none";this.addEvent(t);this._add_rec_marker(this.getEvent(u),n[1]*1e3)}else{i.rec_type&&this._roll_back_dates(i);r=this._get_rec_markers(n);for(f in r)this.deleteEvent(r[f].id,!0)}return!0});scheduler.attachEvent("onEventChanged",function(n){var t,n,u,i,r,e,f;if(this._loading)return!0;if(t=this.getEvent(n),n.toString().indexOf("#")!=-1)n=n.split("#"),u=this.uid(),this._not_render=!0,i=this._copy_event(t),i.id=u,i.event_pid=n[0],i.event_length=n[1],i.rec_type=i.rec_pattern="",this.addEvent(i),this._not_render=!1,this._add_rec_marker(this.getEvent(u),n[1]*1e3);else{if(t.rec_type){var o=t.start_date.getFullYear(),s=t.start_date.getMonth(),h=t.start_date.getDate(),c=t.start_date.getHours(),l=t.start_date.getMinutes();this._roll_back_dates(t);t.start_date=new Date(o,s,h,c,l)}if(r=this._get_rec_markers(n),r||r.length)for(e in r)f=r[e].id,this._del_rec_marker(f),this.deleteEvent(f,!0);this._select_id=null}return!0});scheduler.attachEvent("onEventAdded",function(n){if(!this._loading){var t=this.getEvent(n);t.rec_type&&!t.event_length&&this._roll_back_dates(t)}return!0});scheduler.attachEvent("onEventCreated",function(n){var t=this.getEvent(n);return t.rec_type||(t.rec_type=t.rec_pattern=""),!0});scheduler.attachEvent("onEventCancel",function(n){var t=this.getEvent(n);t.rec_type&&(this._roll_back_dates(t),this.render_view_data(t.id))});scheduler._roll_back_dates=function(n){n.event_length=(n.end_date.valueOf()-n.start_date.valueOf())/1e3;n.end_date=n._end_date;n._start_date&&(n.start_date.setMonth(0),n.start_date.setDate(n._start_date.getDate()),n.start_date.setMonth(n._start_date.getMonth()),n.start_date.setFullYear(n._start_date.getFullYear()))};scheduler.validId=function(n){return n.toString().indexOf("#")==-1};scheduler.showLightbox_rec=scheduler.showLightbox;scheduler.showLightbox=function(n){var t=null;if(this.getEvent(n)&&this.getEvent(n).event_pid&&(t=this.getEvent(n).event_pid),n.toString().indexOf("#")!=-1&&(t=n.split("#")[0]),!t||t==0||!this.locale.labels.confirm_recurring||!confirm(this.locale.labels.confirm_recurring))return this.showLightbox_rec(n);t=this.getEvent(t);try{t.end_date}catch(i){return}return t._end_date=t.end_date,t.end_date=new Date(t.start_date.valueOf()+t.event_length*1e3),this.showLightbox_rec(t.id)};scheduler.get_visible_events_rec=scheduler.get_visible_events;scheduler.get_visible_events=function(){for(var t,i,n=0;n<this._rec_temp.length;n++)delete this._events[this._rec_temp[n].id];for(this._rec_temp=[],t=this.get_visible_events_rec(),i=[],n=0;n<t.length;n++)t[n].rec_type?t[n].rec_pattern!="none"&&this.repeat_date(t[n],i):i.push(t[n]);return i},function(){var n=scheduler.is_one_day_event;scheduler.is_one_day_event=function(t){return t.rec_type?!0:n.call(this,t)}}();scheduler.transponse_size={day:1,week:7,month:1,year:12};scheduler.date.day_week=function(n,t,i){n.setDate(1);i=(i-1)*7;var u=n.getDay(),r=t*1+i-u+1;n.setDate(r<=i?r+7:r)};scheduler.transpose_day_week=function(n,t,i,r,u){for(var e=(n.getDay()||(scheduler.config.start_on_monday?7:0))-i,f=0;f<t.length;f++)if(t[f]>e)return n.setDate(n.getDate()+t[f]*1-e-(r?i:u));this.transpose_day_week(n,t,i+r,null,i)};scheduler.transpose_type=function(n){var f="transpose_"+n,i,u;if(!this.date[f]){var t=n.split("_"),o=864e5,e="add_"+n,r=this.transponse_size[t[0]]*t[1];if(t[0]=="day"||t[0]=="week"){if(i=null,t[4]&&(i=t[4].split(","),scheduler.config.start_on_monday)){for(u=0;u<i.length;u++)i[u]=i[u]*1||7;i.sort()}this.date[f]=function(n,t){var u=Math.floor((t.valueOf()-n.valueOf())/(o*r));u>0&&n.setDate(n.getDate()+u*r);i&&scheduler.transpose_day_week(n,i,1,r)};this.date[e]=function(n,t){var u=new Date(n.valueOf()),f;if(i)for(f=0;f<t;f++)scheduler.transpose_day_week(u,i,0,r);else u.setDate(u.getDate()+t*r);return u}}else(t[0]=="month"||t[0]=="year")&&(this.date[f]=function(n,i){var u=Math.ceil((i.getFullYear()*12+i.getMonth()*1-(n.getFullYear()*12+n.getMonth()*1))/r);u>=0&&n.setMonth(n.getMonth()+u*r);t[3]&&scheduler.date.day_week(n,t[2],t[3])},this.date[e]=function(n,i){var u=new Date(n.valueOf());return u.setMonth(u.getMonth()+i*r),t[3]&&scheduler.date.day_week(u,t[2],t[3]),u})}};scheduler.repeat_date=function(n,t,i,r,u){var e,h,l,s,c,f,o;for(n.rec_pattern?(r=this._min_date,u=this._max_date):(r=r||this._min_date,u=u||this._max_date),e=new Date(n.start_date.valueOf()),!n.rec_pattern&&n.rec_type&&(n.rec_pattern=n.rec_type.split("#")[0]),this.transpose_type(n.rec_pattern),scheduler.date["transpose_"+n.rec_pattern](e,r);e<n.start_date||e.valueOf()+n.event_length*1e3<=r.valueOf();)e=this.date.add(e,1,n.rec_pattern);for(h=n._end_date?new Date(n._end_date.getFullYear(),n._end_date.getMonth(),n._end_date.getDate()+1):new Date(n.end_date.getFullYear(),n.end_date.getMonth(),n.end_date.getDate()+1),l=0;e<u&&e<h;){if(s=this._get_rec_marker(e.valueOf(),n.id),s)i&&t.push(s);else{if(c=new Date(e.valueOf()+n.event_length*1e3),f=this._copy_event(n),f.start_date=e,f.event_pid=n.id,f.id=n.id+"#"+Math.ceil(e.valueOf()/1e3),f.end_date=c,o=f.start_date.getTimezoneOffset()-f.end_date.getTimezoneOffset(),o&&(f.end_date=o>0?new Date(e.valueOf()+n.event_length*1e3-o*6e4):new Date(f.end_date.valueOf()+o*6e4)),f._timed=this.is_one_day_event(f),!f._timed&&!this._table_view&&!this.config.multi_day)return;t.push(f);i||(this._events[f.id]=f,this._rec_temp.push(f))}e=this.date.add(e,1,n.rec_pattern)}};scheduler.getRecDates=function(n,t){var i=typeof n=="object"?n:scheduler.getEvent(n),f=0,e=[],r,u,o,s,h;if(t=t||1e3,r=new Date(i.start_date.valueOf()),u=new Date(r.valueOf()),!i.rec_type)return[{start_date:i.start_date,end_date:i.end_date}];for(this.transpose_type(i.rec_pattern),scheduler.date["transpose_"+i.rec_pattern](r,u);r<i.start_date||r.valueOf()+i.event_length*1e3<=u.valueOf();)r=this.date.add(r,1,i.rec_pattern);while(r<i.end_date)if(o=this._get_rec_marker(r.valueOf(),i.id),o||(s=new Date(r.valueOf()+i.event_length*1e3),h=new Date(r),e.push({start_date:h,end_date:s})),r=this.date.add(r,1,i.rec_pattern),f++,f==t)break;return e};scheduler.getEvents=function(n,t){var f=[],e,i,r,u;for(e in this._events)if(i=this._events[e],i&&i.start_date<t&&i.end_date>=n)if(i.rec_pattern){if(i.rec_pattern=="none")continue;for(r=[],this.repeat_date(i,r,!0,n,t),u=0;u<r.length;u++)!r[u].rec_pattern&&r[u].start_date<t&&r[u].end_date>n&&f.push(r[u])}else i.event_pid&&i.event_pid!=0||f.push(i);return f};scheduler.config.repeat_date="%Y-%m-%d";scheduler.config.lightbox.sections=[{name:"description",height:130,map_to:"text",type:"textarea",focus:!0},{name:"recurring",height:115,type:"recurring",map_to:"rec_type",button:"recurring"},{name:"time",height:72,type:"time",map_to:"auto"}];scheduler._copy_dummy=function(){this.start_date=new Date(this.start_date);this.end_date=new Date(this.end_date);this.event_length=this.event_pid=this.rec_pattern=this.rec_type=this._timed=null};scheduler.__recurring_template='<div class="dhx_form_repeat"> <form> <div class="dhx_repeat_left"> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="day" />Daily<\/label><label><input class="dhx_repeat_radio" type="radio" name="repeat" value="week"/>Weekly<\/label><label><input class="dhx_repeat_radio" type="radio" name="repeat" value="month" checked />Monthly<\/label><label><input class="dhx_repeat_radio" type="radio" name="repeat" value="year" />Yearly<\/label> <\/div> <div class="dhx_repeat_divider"><\/div> <div class="dhx_repeat_center"> <div style="display:none;" id="dhx_repeat_day"> <label><input class="dhx_repeat_radio" type="radio" name="day_type" value="d"/>Every<\/label><input class="dhx_repeat_text" type="text" name="day_count" value="1" />day<label><input class="dhx_repeat_radio" type="radio" name="day_type" checked value="w"/>Every workday<\/label> <\/div> <div style="display:none;" id="dhx_repeat_week"> Repeat every<input class="dhx_repeat_text" type="text" name="week_count" value="1" />week next days:<table class="dhx_repeat_days"> <tr> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="1" />Monday<\/label><label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="4" />Thursday<\/label> <\/td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="2" />Tuesday<\/label><label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="5" />Friday<\/label> <\/td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="3" />Wednesday<\/label><label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="6" />Saturday<\/label> <\/td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="0" />Sunday<\/label><\/td> <\/tr> <\/table> <\/div> <div id="dhx_repeat_month"> <label><input class="dhx_repeat_radio" type="radio" name="month_type" value="d"/>Repeat<\/label><input class="dhx_repeat_text" type="text" name="month_day" value="1" />day every<input class="dhx_repeat_text" type="text" name="month_count" value="1" />month<label><input class="dhx_repeat_radio" type="radio" name="month_type" checked value="w"/>On<\/label><input class="dhx_repeat_text" type="text" name="month_week2" value="1" /><select name="month_day2"><option value="1" selected >Monday<option value="2">Tuesday<option value="3">Wednesday<option value="4">Thursday<option value="5">Friday<option value="6">Saturday<option value="0">Sunday<\/select>every<input class="dhx_repeat_text" type="text" name="month_count2" value="1" />month<\/div> <div style="display:none;" id="dhx_repeat_year"> <label><input class="dhx_repeat_radio" type="radio" name="year_type" value="d"/>Every<\/label><input class="dhx_repeat_text" type="text" name="year_day" value="1" />day<select name="year_month"><option value="0" selected >January<option value="1">February<option value="2">March<option value="3">April<option value="4">May<option value="5">June<option value="6">July<option value="7">August<option value="8">September<option value="9">October<option value="10">November<option value="11">December<\/select>month<label><input class="dhx_repeat_radio" type="radio" name="year_type" checked value="w"/>On<\/label><input class="dhx_repeat_text" type="text" name="year_week2" value="1" /><select name="year_day2"><option value="1" selected >Monday<option value="2">Tuesday<option value="3">Wednesday<option value="4">Thursday<option value="5">Friday<option value="6">Saturday<option value="7">Sunday<\/select>of<select name="year_month2"><option value="0" selected >January<option value="1">February<option value="2">March<option value="3">April<option value="4">May<option value="5">June<option value="6">July<option value="7">August<option value="8">September<option value="9">October<option value="10">November<option value="11">December<\/select><\/div> <\/div> <div class="dhx_repeat_divider"><\/div> <div class="dhx_repeat_right"> <label><input class="dhx_repeat_radio" type="radio" name="end" checked/>No end date<\/label><label><input class="dhx_repeat_radio" type="radio" name="end" />After<\/label><input class="dhx_repeat_text" type="text" name="occurences_count" value="1" />occurrences<label><input class="dhx_repeat_radio" type="radio" name="end" />End by<\/label><input class="dhx_repeat_date" type="text" name="date_of_end" value="01.01.2010" /><\/div> <\/form> <\/div> <div style="clear:both"> <\/div>';scheduler.optenddate_onclick=function(n){scheduler.destroyCalendar();scheduler.renderCalendar({position:"date_of_end",date:n.value,adjust:-130,navigation:!0,handler:function(n){scheduler.setOptionEndDate(n);scheduler.destroyCalendar()}})};scheduler.repeat_onclick=function(){var n=document.getElementsByName("repeat"),t,r;for(i=0;i<n.length;i++)if(n[i].checked==!0)break;n[i].value=="month"?(t=document.getElementsByName("month_type"),scheduler.month_type0_onclick(t[0]),scheduler.month_type1_onclick(t[1])):n[i].value=="year"&&(r=document.getElementsByName("year_type"),scheduler.year_type0_onclick(r[0]),scheduler.year_type1_onclick(r[1]))};scheduler.count_onchange=function(n){r=n.value.match(/\d+/g);n.value=r?r[0]:1};scheduler.month_type0_onclick=function(n){if(n.checked==!0){var t=document.getElementsByName("month_day");if(n=document.getElementById("bsinputstart"),!n.value)return;mdt=new Date(n.value);t[0].value=mdt.getDate()}};scheduler.month_type1_onclick=function(t){if(t.checked==!0){var i=document.getElementsByName("month_week2"),r=document.getElementsByName("month_day2");if(t=document.getElementById("bsinputstart"),!t.value)return;mdt=new Date(t.value);n=Math.floor(mdt.getDate()/7);a=mdt.getDate()%7;a>0&&n++;i[0].value=n;idx=mdt.getDay()-1;idx<0&&(idx=6);r[0].selectedIndex=idx}};scheduler.month_day_onchange=function(n){var o=document.getElementsByName("month_type"),t,e,i,u,f;if(o[0].checked==!0){if(t=document.getElementById("bsinputstart"),e=document.getElementsByName("month_day"),mdate=new Date(t.value),r=n.value.match(/\d+/g),!r){e[0].value=mdate.getDate();return}if(i=new Date(mdate.getFullYear(),mdate.getMonth(),r[0]),i.getDate()==r[0])u="0"+(mdate.getMonth()+1),u=u.substr(u.length-2,u.length),f="0"+i.getDate(),f=f.substr(f.length-2,f.length),t.value=mdate.getFullYear()+"-"+u+"-"+f,t._date.setFullYear(i.getFullYear()),t._date.setMonth(i.getMonth()),t._date.setDate(i.getDate());else{e[0].value=mdate.getDate();return}}};scheduler.month_week_onchange=function(){var o=document.getElementsByName("month_type"),i,u;if(o[1].checked==!0){var t=document.getElementById("bsinputstart"),f=document.getElementsByName("month_week2"),e=document.getElementsByName("month_day2");if(r=f[0].value.match(/\d+/g),!r){mdtw=new Date(t.value);n=Math.floor(mdtw.getDate()/7);a=mdtw.getDate()%7;a>0&&n++;f[0].value=n;return}r[0]>4&&(r[0]=4,f[0].value=r[0]);wdt=new Date(t.value);wdt.setDate(1);dy=e[0].options[e[0].selectedIndex].value-wdt.getDay()+1;dy<=0&&(dy+=7);dtm=wdt.setDate(dy);dtm=wdt.getTime();dtm+=6048e5*(r[0]-1);wdt.setTime(dtm);i="0"+(wdt.getMonth()+1);i=i.substr(i.length-2,i.length);u="0"+wdt.getDate();u=u.substr(u.length-2,u.length);t.value=wdt.getFullYear()+"-"+i+"-"+u;t._date.setFullYear(wdt.getFullYear());t._date.setMonth(wdt.getMonth());t._date.setDate(wdt.getDate())}};scheduler.year_type0_onclick=function(n){var t,i;if(n.checked==!0){if(n=document.getElementById("bsinputstart"),!n.value)return;mdt=new Date(n.value);t=document.getElementsByName("year_day");t[0].value=mdt.getDate();i=document.getElementsByName("year_month");i[0].selectedIndex=mdt.getMonth()}};scheduler.year_type1_onclick=function(t){var i,r,u;if(t.checked==!0){if(t=document.getElementById("bsinputstart"),!t.value)return;mdt=new Date(t.value);i=document.getElementsByName("year_day2");r=document.getElementsByName("year_week2");n=Math.floor(mdt.getDate()/7);a=mdt.getDate()%7;a>0&&n++;r[0].value=n;idx=mdt.getDay()-1;idx<0&&(idx=6);i[0].selectedIndex=idx;u=document.getElementsByName("year_month2");u[0].selectedIndex=mdt.getMonth()}};scheduler.year_day_onchange=function(){var o=document.getElementsByName("year_type"),f,n,i,r;if(o[0].checked==!0){var u=document.getElementById("bsinputstart"),e=document.getElementsByName("year_day"),t=document.getElementsByName("year_month");if(wdt=new Date(u.value),f=e[0].value.match(/\d+/g),!f){e[0].value=wdt.getDate();t[0].selectIndex=wdt.getMonth();return}if(n=new Date(wdt.getFullYear(),t[0].options[t[0].selectedIndex].value,f[0]),t[0].options[t[0].selectedIndex].value==n.getMonth()&&f[0]==n.getDate())i="0"+(n.getMonth()+1),i=i.substr(i.length-2,i.length),r="0"+n.getDate(),r=r.substr(r.length-2,r.length),u.value=n.getFullYear()+"-"+i+"-"+r,u._date.setFullYear(n.getFullYear()),u._date.setMonth(n.getMonth()),u._date.setDate(n.getDate());else{e[0].value=wdt.getDate();t[0].selectedIndex=wdt.getMonth();return}}};scheduler.year_week_onchange=function(){var s=document.getElementsByName("year_type"),t,i;if(s[1].checked==!0){var u=document.getElementById("bsinputstart"),f=document.getElementsByName("year_day2"),e=document.getElementsByName("year_week2"),o=document.getElementsByName("year_month2");if(wdt=new Date(u.value),r=e[0].value.match(/\d+/g),!r){n=Math.floor(wdt.getDate()/7);a=wdt.getDate()%7;a>0&&n++;e[0].value=n;idx=wdt.getDay()-1;idx<0&&(idx=6);f[0].selectedIndex=idx;o[0].selectedIndex=wdt.getMonth();return}r[0]>4&&(r[0]=4,e[0].value=r[0]);wdt.setDate(1);wdt.setMonth(o[0].options[o[0].selectedIndex].value);dy=f[0].options[f[0].selectedIndex].value-wdt.getDay()+1;dy<=0&&(dy+=7);dtm=wdt.setDate(dy);dtm=wdt.getTime();dtm+=6048e5*(r[0]-1);wdt.setTime(dtm);t="0"+(wdt.getMonth()+1);t=t.substr(t.length-2,t.length);i="0"+wdt.getDate();i=i.substr(i.length-2,i.length);u.value=wdt.getFullYear()+"-"+t+"-"+i;u._date.setFullYear(wdt.getFullYear());u._date.setMonth(wdt.getMonth());u._date.setDate(wdt.getDate())}};scheduler.bsinputstart_onchange=function(){var h=document.getElementsByClassName("dhx_form_repeat"),e,t,f,u,o,s,i,r;if(h[0].open&&(e=document.getElementById("bsinputstart"),u=document.getElementsByName("month_type"),u)&&(u[0].checked==!0&&(f=document.getElementsByName("month_day"),f[0].value=t.getDate()),u[1].checked==!0&&(t=new Date(e.value),n=Math.floor(t.getDate()/7),a=t.getDate()%7,a>0&&n++,n==5&&(n=4,les=t.valueOf()-6048e5,t.setTime(les),i="0"+(t.getMonth()+1),i=i.substr(i.length-2,i.length),r="0"+t.getDate(),r=r.substr(r.length-2,r.length),e.value=t.getFullYear()+"-"+i+"-"+r),f=document.getElementsByName("month_week2"),f[0].value=n,f=document.getElementsByName("month_day2"),idx=t.getDay()-1,idx<0&&(idx=6),f[0].selectedIndex=idx),u=document.getElementsByName("year_type"),u)&&(u[0].checked==!0&&(o=document.getElementsByName("year_day"),s=document.getElementsByName("year_month"),o[0].value=t.getDate(),s[0].selectIndex=t.getMonth()),u[1].checked==!0)){var t=new Date(e.value),o=document.getElementsByName("year_day2"),c=document.getElementsByName("year_week2"),s=document.getElementsByName("year_month2");n=Math.floor(t.getDate()/7);a=t.getDate()%7;a>0&&n++;n==5&&(n=4,les=t.valueOf()-6048e5,t.setTime(les),i="0"+(t.getMonth()+1),i=i.substr(i.length-2,i.length),r="0"+t.getDate(),r=r.substr(r.length-2,r.length),e.value=t.getFullYear()+"-"+i+"-"+r);c[0].value=n;idx=t.getDay()-1;idx<0&&(idx=6);o[0].selectedIndex=idx;s[0].selectedIndex=t.getMonth()}};scheduler.setOptionEndDate=function(n){var i="0"+(n.getMonth()+1),t;return i=i.substr(i.length-2,i.length),t="0"+n.getDate(),t=t.substr(t.length-2,t.length),document.getElementById("date_of_end").value=n.getFullYear()+"-"+i+"-"+t,!0};scheduler.listchange=function(){scheduler.emsendchange();scheduler.mbmemlistchange()};scheduler.emsendchange=function(){var t="",i=document.getElementsByName("emsend"),r,n;for(t=i[0].checked==!0?"#SEND#":"#NONE#",r=document.getElementById("memberslist"),mlt_members=r.children,n=0;n<mlt_members.length;n++)t+=mlt_members[n].getAttribute("value"),t+=","+mlt_members[n].innerHTML+"/";i=document.getElementById("sendemlst");i.value=t};scheduler.attachEvent("onEventIdChange",function(n,t){var i=this._events[t];i&&(i.event_pid||(this._events[t].event_mid=i.id))});scheduler.changedivcode=function(){var n=document.getElementById("bsdivcodeselect"),t,r,u;for(n.disabled=!0,t=document.getElementById("uselectlist"),t.disabled=!0,r=n.options.length,u=0,i=0;i<r;i++)if(n.options[i].selected==!0){dc=n.options[i].value;break}dclink=bsgetulistlink()+dc;dhtmlxAjax.get(dclink,function(r){var u;if(window.DOMParser?(parser=new DOMParser,u=parser.parseFromString(r.xmlDoc.responseText,"text/xml")):(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(r.xmlDoc.responseText)),u){t.innerHTML="";var o="",f=u.getElementsByTagName("uid"),e=u.getElementsByTagName("uname"),s=f.length;for(i=0;i<s;i++)uid=f[i].text?f[i].text:f[i].textContent,uname=e[i].text?e[i].text:e[i].textContent,o+="<div value="+uid+" onclick='scheduler.touchmultifocus(\"In\",this);'>"+uname+"<\/div>";t.innerHTML=o;n.disabled=!1;t.disabled=!1;scheduler.resetuselectlist()}})};scheduler.touchmultifocus=function(n,t){var u=document.getElementById("uselectlist"),r=document.getElementById("memberslist"),i;if(sval=jQuery(".subblock_category select").val(),sval!="category_1"){if(n=="In"){for(uname=t.innerHTML,setval=t.getAttribute("value"),mlt_members=r.children,i=0;i<mlt_members.length;i++)if(setval==mlt_members[i].getAttribute("value"))return;for(r.innerHTML=r.innerHTML+"<div value='"+setval+"' onclick='scheduler.touchmultifocus(\"Out\",this);'>"+uname+"<\/div>",childdiv=jQuery("#uselectlist").children(),i=0;i<childdiv.length;i++)childdiv.eq(i).attr("value")==setval&&childdiv.eq(i).addClass("dismode")}else for(t.parentNode.removeChild(t),setval=t.getAttribute("value"),childdiv=jQuery("#uselectlist").children(),i=0;i<childdiv.length;i++)childdiv.eq(i).attr("value")==setval&&childdiv.eq(i).removeClass("dismode");scheduler.listchange(n)}};scheduler.mbmemlistchange=function(){return};scheduler.categorychange=function(){disset=jQuery("#memberslist").hasClass("dismode");sval=jQuery(".subblock_category select").val();sval=="category_1"?disset||(jQuery("#memberslist").empty(),scheduler.listchange("Out"),jQuery("#memberslist").addClass("dismode")):disset&&jQuery("#memberslist").removeClass("dismode")};scheduler.resetuselectlist=function(){for(userdiv=jQuery("#uselectlist").children(),memdiv=jQuery("#memberslist").children(),i=0;i<userdiv.length;i++){for(dism=!1,j=0;j<memdiv.length;j++)userdiv.eq(i).attr("value")==memdiv.eq(j).attr("value")&&(userdiv.eq(i).addClass("dismode"),dism=!0);dism||userdiv.eq(i).removeClass("dismode")}}